---
name: Implement OAuth2 Flow and Token Storage
status: open
created: 2025-09-06T20:46:05Z
updated: 2025-09-06T20:53:11Z
github: https://github.com/tyu-mit/easyDeploy/issues/3
depends_on: [3]
parallel: false
conflicts_with: []
---

# Task: Implement OAuth2 Flow and Token Storage

## Description
Implement the core OAuth2 authentication flow using google-auth-oauthlib. This includes browser-based authentication, token exchange, and simple JSON file storage for credentials.

## Acceptance Criteria
- [ ] Implement OAuth2 flow with PKCE for security
- [ ] Launch system browser for GCP authentication
- [ ] Handle OAuth callback on localhost (port 8080 with fallback)
- [ ] Exchange authorization code for access/refresh tokens
- [ ] Save tokens to `~/.easydeploy/gcp-token.json` in plain JSON
- [ ] Implement token loading and validation functions
- [ ] Add basic token refresh capability

## Technical Details
- Use google-auth-oauthlib.flow.InstalledAppFlow for OAuth flow
- Configure required GCP scopes:
  - https://www.googleapis.com/auth/compute
  - https://www.googleapis.com/auth/devstorage.full_control
  - https://www.googleapis.com/auth/cloud-platform.read-only
- Store tokens as plain JSON (no encryption for internal tool)
- Include functions: `authenticate()`, `load_credentials()`, `is_authenticated()`, `refresh_token()`

## Dependencies
- [ ] Task 001 completed (dependencies and structure)
- [ ] GCP OAuth application configured with client ID/secret

## Effort Estimate
- Size: M
- Hours: 8-12 hours
- Parallel: false (core functionality)

## Definition of Done
- [ ] OAuth flow working with real GCP accounts
- [ ] Tokens saved and loaded correctly
- [ ] Token validation working
- [ ] Basic refresh mechanism implemented
- [ ] Manual testing with browser flow successful
